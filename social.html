<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Social Media - FrameAcademy App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body{
            margin:0;
            font-family:'Poppins', sans-serif;
            background: radial-gradient(circle at top, #2d2d2d, #1b1b1b 45%, #121212 100%);
            min-height:100vh;
            color:#fff;
        }

        .social-hero{
            padding: 140px 20px 40px;
            text-align: center;
        }

        .home-pill{
            display: inline-block;
            background: linear-gradient(90deg, #b200ff, #ff5fd8);
            color: #fff;
            padding: 14px 40px;
            border-radius: 40px;
            font-weight: 700;
            letter-spacing: 1px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            text-transform: uppercase;
        }

        .social-title{
            margin-top: 20px;
            font-size: clamp(48px, 8vw, 110px);
            font-weight: 800;
            letter-spacing: 4px;
            color: transparent;
            -webkit-text-stroke: 3px #ffffff;
            text-transform: uppercase;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .social-grid{
            margin: 40px auto 0;
            width: min(900px, 92%);
            display: grid;
            grid-template-columns: repeat(3, minmax(140px, 1fr));
            gap: 30px;
            justify-items: center;
        }

        .social-card{
            width: 140px;
            height: 140px;
            border-radius: 28px;
            background: #1e1e1e;
            display:flex;
            align-items:center;
            justify-content:center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .social-card img{
            width: 80px;
            height: 80px;
        }

        .social-card:hover{
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.65);
        }

        .tiktok{ box-shadow: 0 0 25px rgba(255,0,255,0.6), 0 20px 40px rgba(0,0,0,0.5); }
        .youtube{ box-shadow: 0 0 25px rgba(255,0,0,0.5), 0 20px 40px rgba(0,0,0,0.5); }
        .whatsapp{ box-shadow: 0 0 25px rgba(0,255,0,0.5), 0 20px 40px rgba(0,0,0,0.5); }
        .telegram{ box-shadow: 0 0 25px rgba(0,170,255,0.5), 0 20px 40px rgba(0,0,0,0.5); }
        .vk{ box-shadow: 0 0 25px rgba(40,120,255,0.5), 0 20px 40px rgba(0,0,0,0.5); }

        @media (max-width: 700px){
            .social-grid{
                grid-template-columns: repeat(2, minmax(140px, 1fr));
            }
        }
    </style>
</head>
<body>

<!-- ðŸ” HEADER -->
<header>
    <div class="logo">
        <img src="https://img.freepik.com/free-vector/bird-colorful-gradient-design-vector_343694-2506.jpg" width="40" alt="FrameAcademy logo">
        <span>FrameAcademy App</span>
    </div>
    <nav>
        <a href="index.html">HOME</a>
        <a href="aboutus.html">ABOUT</a>
        <a href="gallery.html">GALLERY</a>
        <a href="social.html" class="active">SOCIAL MEDIA</a>
        <a href="contact.html">CONTACT</a>
    </nav>
    <div class="user-chip">
        <img id="headerAvatar" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User avatar">
        <span id="headerName">USER</span>
    </div>
    <div class="menu">â˜°</div>
</header>

<!-- SIDE MENU -->
<div class="side-menu" id="sideMenu">
    <div class="side-header">
        <div class="user-avatar">
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User avatar">
        </div>
        <h3>USER_NAME</h3>
        <div class="side-email" id="sideEmail">user@email.com</div>
        <p>City â€¢ Age</p>
    </div>

    <div class="side-links">
        <button id="editProfileBtn" class="profile-btn">Edit Profile</button>
        <a href="index.html">HOME</a>
        <a href="aboutus.html">ABOUT</a>
        <a href="gallery.html">GALLERY</a>
        <a href="social.html">SOCIAL MEDIA</a>
        <a href="contact.html">CONTACT</a>
    </div>

    <div class="auth-buttons">
        <a id="loginBtn" href="kiru.html" class="auth-btn">Log in</a>
        <a id="registerBtn" href="tirkelu.html" class="auth-btn">Register</a>
        <button id="logoutBtn" class="auth-btn" onclick="logout()" style="display:none;">Log Out</button>
    </div>
</div>

<div class="side-overlay" id="sideOverlay"></div>

<section class="social-hero">
    <div class="home-pill">Home page menu</div>
    <h1 class="social-title">SOCIAL MEDIA</h1>

    <div class="social-grid">
        <a class="social-card tiktok" href="#" aria-label="TikTok">
            <img src="https://cdn-icons-png.flaticon.com/512/3046/3046121.png" alt="TikTok">
        </a>
        <a class="social-card youtube" href="#" aria-label="YouTube">
            <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube">
        </a>
        <a class="social-card whatsapp" href="#" aria-label="WhatsApp">
            <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp">
        </a>
        <a class="social-card telegram" href="#" aria-label="Telegram">
            <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram">
        </a>
        <a class="social-card vk" href="#" aria-label="VK">
            <img src="https://cdn-icons-png.flaticon.com/512/145/145813.png" alt="VK">
        </a>
    </div>
</section>

<div class="profile-modal" id="profileModal">
    <div class="modal-card">
        <div class="modal-title">Edit Profile</div>
        <div class="modal-grid">
            <div class="modal-field">
                <label for="profileName">Name</label>
                <input id="profileName" type="text" placeholder="Your name">
            </div>
            <div class="modal-field">
                <label for="profileCity">City</label>
                <input id="profileCity" type="text" placeholder="Your city">
            </div>
            <div class="modal-field">
                <label for="profileAge">Age</label>
                <input id="profileAge" type="number" min="1" max="120" placeholder="Your age">
            </div>
            <div class="modal-field">
                <label for="profileAvatarFile">Avatar file</label>
                <input id="profileAvatarFile" type="file" accept="image/*">
            </div>
        </div>
        <div class="modal-row">
            <img id="profileAvatarPreview" class="avatar-preview" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Avatar preview">
            <div>Preview</div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" id="profileCancel">Cancel</button>
            <button class="btn-primary" id="profileSave">Save</button>
        </div>
    </div>
</div>

<script>
    const menuBtn = document.querySelector('.menu');
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideOverlay');

    menuBtn.addEventListener('click', () => {
        sideMenu.classList.add('active');
        overlay.classList.add('active');
    });

    overlay.addEventListener('click', () => {
        sideMenu.classList.remove('active');
        overlay.classList.remove('active');
    });
</script>

<script>
  self.FIREBASE_APPCHECK_DEBUG_TOKEN = true;
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  import { initializeAppCheck, ReCaptchaEnterpriseProvider } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app-check.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCr6pAI4GCkwnlZEBq_1M1dWeWpGtrn1a4",
    authDomain: "frameacademy-bb04a.firebaseapp.com",
    projectId: "frameacademy-bb04a",
    storageBucket: "frameacademy-bb04a.firebasestorage.app",
    messagingSenderId: "1018686855581",
    appId: "1:1018686855581:web:e4f5d6f42ee6d43ba8b774",
    measurementId: "G-SDMK2NPGBZ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  initializeAppCheck(app, {
    provider: new ReCaptchaEnterpriseProvider("6Leh0WYsAAAAAHISvriKLV94fJuWFuJRgIaXbGUb"),
    isTokenAutoRefreshEnabled: true
  });

  const loginBtn = document.getElementById('loginBtn');
  const registerBtn = document.getElementById('registerBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const userNameH3 = document.querySelector('.side-header h3');
  const userMetaP = document.querySelector('.side-header p');
  const sideEmail = document.getElementById('sideEmail');
  const sideAvatar = document.querySelector('.side-header img');
  const headerName = document.getElementById('headerName');
  const headerAvatar = document.getElementById('headerAvatar');
  const editProfileBtn = document.getElementById('editProfileBtn');
  const profileModal = document.getElementById('profileModal');
  const profileName = document.getElementById('profileName');
  const profileCity = document.getElementById('profileCity');
  const profileAge = document.getElementById('profileAge');
  const profileAvatarFile = document.getElementById('profileAvatarFile');
  const profileAvatarPreview = document.getElementById('profileAvatarPreview');
  const profileSave = document.getElementById('profileSave');
  const profileCancel = document.getElementById('profileCancel');
  let pendingAvatarData = "";
  let toastTimer;

  function showToast(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'toast';
      document.body.appendChild(toast);
    }
    toast.innerHTML = '';
    const title = document.createElement('div');
    title.className = 'toast-title';
    title.textContent = 'Push notification';
    const msg = document.createElement('div');
    msg.className = 'toast-msg';
    msg.textContent = message;
    toast.appendChild(title);
    toast.appendChild(msg);
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
      toast.classList.remove('show');
    }, 2400);
  }

  function getProfile() {
    const raw = localStorage.getItem('profile');
    if (!raw) return { name: "", city: "", age: "", avatarData: "" };
    try { return JSON.parse(raw); } catch { return { name: "", city: "", age: "", avatarData: "" }; }
  }

  function setProfile(profile) {
    localStorage.setItem('profile', JSON.stringify(profile));
  }

  async function fetchProfile(user) {
    if (!user) return getProfile();
    try {
      const snap = await getDoc(doc(db, "users", user.uid));
      if (snap.exists()) {
        const data = snap.data();
        const profile = {
          name: data.name || "",
          city: data.city || "",
          age: data.age || "",
          avatarData: data.avatarData || ""
        };
        setProfile(profile);
        return profile;
      }
    } catch (err) {
      console.warn("Profile load failed:", err);
    }
    return getProfile();
  }

  async function applyProfile(user) {
    const profile = await fetchProfile(user);
    const displayName = profile.name || (user && (user.displayName || user.email || user.phoneNumber)) || "USER";
    const city = profile.city || "City";
    const age = profile.age || "Age";
    const avatar = profile.avatarData || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
    const email = (user && user.email) ? user.email : "";

    if (userNameH3) userNameH3.textContent = displayName;
    if (userMetaP) userMetaP.textContent = `${city} â€¢ ${age}`;
    if (sideEmail) sideEmail.textContent = email || "";
    if (sideAvatar) sideAvatar.src = avatar;
    if (headerName) headerName.textContent = displayName;
    if (headerAvatar) headerAvatar.src = avatar;
    if (profileAvatarPreview) profileAvatarPreview.src = avatar;
  }

  window.logout = async () => {
    try {
      await signOut(auth);
      localStorage.removeItem('profile');
      await applyProfile(null);
      showToast("Signed out");
      document.getElementById('sideMenu').classList.remove('active');
      document.getElementById('sideOverlay').classList.remove('active');
    } catch (err) {
      showToast(err.message);
    }
  };

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      await applyProfile(user);
      loginBtn.style.display = 'none';
      registerBtn.style.display = 'none';
      logoutBtn.style.display = 'block';
    } else {
      await applyProfile(null);
      loginBtn.style.display = 'inline-block';
      registerBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
    }
  });

  if (editProfileBtn && profileModal) {
    editProfileBtn.addEventListener('click', () => {
      const current = getProfile();
      profileName.value = current.name || "";
      profileCity.value = current.city || "";
      profileAge.value = current.age || "";
      pendingAvatarData = current.avatarData || "";
      profileAvatarPreview.src = pendingAvatarData || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
      profileAvatarFile.value = "";
      profileModal.classList.add('active');
    });
  }

  if (profileCancel && profileModal) {
    profileCancel.addEventListener('click', () => {
      profileModal.classList.remove('active');
    });
  }

  if (profileAvatarFile) {
    profileAvatarFile.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        pendingAvatarData = String(reader.result || "");
        profileAvatarPreview.src = pendingAvatarData;
      };
      reader.readAsDataURL(file);
    });
  }

  if (profileSave && profileModal) {
    profileSave.addEventListener('click', async () => {
      const updated = {
        name: profileName.value.trim(),
        city: profileCity.value.trim(),
        age: profileAge.value.trim(),
        avatarData: pendingAvatarData
      };
      setProfile(updated);
      if (auth.currentUser) {
        try {
          await setDoc(doc(db, "users", auth.currentUser.uid), updated, { merge: true });
        } catch (err) {
          console.warn("Profile save failed:", err);
        }
      }
      await applyProfile(auth.currentUser || null);
      profileModal.classList.remove('active');
    });
  }
</script>

</body>
</html>
