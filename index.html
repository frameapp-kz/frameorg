<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>FrameAcademy App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="has-hero">
    <header>
        <div class="logo">
            <img src="https://img.freepik.com/free-vector/bird-colorful-gradient-design-vector_343694-2506.jpg?semt=ais_hybrid&w=740&q=80" alt="FrameAcademy logo">
            <span>FrameAcademy App</span>
        </div>
        <nav>
            <a href="index.html" class="active" data-i18n="nav_home">HOME</a>
            <a href="aboutus.html" data-i18n="nav_about">ABOUT US</a>
            <a href="gallery.html" data-i18n="nav_gallery">GALLERY</a>
            <a href="social.html" data-i18n="nav_social">SOCIAL MEDIA</a>
            <a href="contact.html" data-i18n="nav_contact">CONTACT</a>
        </nav>
        <div class="lang-switch">
            <select aria-label="Language" data-lang-select>
                <option value="en">English</option>
                <option value="kk">Қазақ Тілі</option>
                <option value="zh">中文</option>
            </select>
        </div>
        <div class="user-chip">
            <img id="headerAvatar" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User avatar">
            <span id="headerName">USER</span>
        </div>
        <div class="menu">☰</div>
    </header>

    <!-- SIDE MENU -->
    <div class="side-menu" id="sideMenu">
    <div class="side-header">
        <div class="user-avatar">
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User avatar">
        </div>
        <h3>USER_NAME</h3>
        <div class="side-email" id="sideEmail">user@email.com</div>
        <p data-i18n="profile_meta">City • Age</p>
    </div>

    <div class="side-links">
        <button id="editProfileBtn" class="profile-btn" data-i18n="edit_profile">Edit Profile</button>
        <div class="side-lang">
            <select aria-label="Language" data-lang-select>
                <option value="en">English</option>
                <option value="kk">Қазақ Тілі</option>
                <option value="zh">中文</option>
            </select>
        </div>
        <a href="index.html" data-i18n="nav_home">HOME</a>
        <a href="aboutus.html" data-i18n="nav_about">ABOUT</a>
        <a href="gallery.html" data-i18n="nav_gallery">GALLERY</a>
        <a href="social.html" data-i18n="nav_social">SOCIAL MEDIA</a>
        <a href="contact.html" data-i18n="nav_contact">CONTACT</a>
    </div>

    <div class="auth-buttons">
            <a id="loginBtn" href="kiru.html" class="auth-btn" data-i18n="auth_login">Log in</a>
            <a id="registerBtn" href="tirkelu.html" class="auth-btn" data-i18n="auth_register">Register</a>
            <button id="logoutBtn" class="auth-btn" onclick="logout()" style="display:none;" data-i18n="auth_logout">Log Out</button>
        </div>
    </div>

    <div class="side-overlay" id="sideOverlay"></div>


    <section class="hero">
        <div class="slide active" style="background-image:url('https://images.unsplash.com/photo-1501785888041-af3ef285b470')"></div>
        <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e')"></div>
        <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee')"></div>
        <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1470770841072-f978cf4d019e')"></div>
        <div class="slide" style="background-image:url('https://resize.tripster.ru/0tDEr_rJhL-yJeHZQRP1dqMFces=/fit-in/1200x1000/filters:no_upscale()/https://cdn.tripster.ru/photos/e68022db-fb64-4932-be2e-f4969c82877d.jpg')"></div>
        
        <div class="overlay"></div>
        
        <div class="center">
            <h1 data-i18n-html="index_title">WELCOME TO<br> FRAME ACADEMY SUPER APP!</h1>
            <button class="start" data-i18n="btn_start">START</button>
            <div class="hero-actions">
                <a class="start secondary" href="bkz.html" data-i18n="btn_release_bkz">Release BlackKZ</a>
                <div class="download-wrap">
                    <a id="downloadBtn" class="start secondary" href="#" role="button" data-i18n="btn_download">Download FrameApp</a>
                    <input id="downloadFile" type="file" class="download-input" />
                    <div id="downloadNote" class="download-note" data-i18n="txt_coming_soon">Coming Soon</div>
                </div>
            </div>
        </div>
        
        <div class="arrow left" onclick="prevSlide()">&#10094;</div>
        <div class="arrow right" onclick="nextSlide()">&#10095;</div>
        
        <div class="dots">
            <div class="dot active"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
        
        <div class="scroll-btn" onclick="scrollDown()">↓</div>
    </section>

    <section class="next" id="next">
        <div class="next-content">
            <div class="app-links">
                <button class="app-card" type="button" data-app-name="YouTube" data-app-browser="https://www.youtube.com/" data-app-link="youtube://">
                    <span class="app-icon">YT</span>
                    <span>YouTube</span>
                </button>
                <button class="app-card" type="button" data-app-name="2GIS" data-app-browser="https://2gis.kz/" data-app-link="dgis://2gis.ru/">
                    <span class="app-icon">2G</span>
                    <span>2GIS</span>
                </button>
                <button class="app-card" type="button" data-app-name="TikTok" data-app-browser="https://www.tiktok.com/" data-app-link="tiktok://">
                    <span class="app-icon">TT</span>
                    <span>TikTok</span>
                </button>
                <button class="app-card" type="button" data-app-name="Yandex Maps" data-app-browser="https://yandex.kz/maps" data-app-link="yandexmaps://">
                    <span class="app-icon">YM</span>
                    <span>Yandex Maps</span>
                </button>
                <button class="app-card" type="button" data-app-name="inDrive" data-app-browser="https://indrive.com/" data-app-link="indrive://">
                    <span class="app-icon">ID</span>
                    <span>inDrive</span>
                </button>
                <button class="app-card" type="button" data-app-name="Steam" data-app-browser="https://store.steampowered.com/" data-app-link="steam://">
                    <span class="app-icon">ST</span>
                    <span>Steam</span>
                </button>
                <button class="app-card" type="button" data-app-name="Google Maps" data-app-browser="https://maps.google.com/" data-app-link="comgooglemaps://">
                    <span class="app-icon">GM</span>
                    <span>Google Maps</span>
                </button>
                <button class="app-card" type="button" data-app-name="WhatsApp" data-app-browser="https://www.whatsapp.com/" data-app-link="whatsapp://">
                    <span class="app-icon">WA</span>
                    <span>WhatsApp</span>
                </button>
                <button class="app-card" type="button" data-app-name="WhatsApp Web" data-app-browser="https://web.whatsapp.com/" data-app-link="https://web.whatsapp.com/">
                    <span class="app-icon">WW</span>
                    <span>WhatsApp Web</span>
                </button>
                <button class="app-card" type="button" data-app-name="Telegram" data-app-browser="https://t.me/" data-app-link="tg://">
                    <span class="app-icon">TG</span>
                    <span>Telegram</span>
                </button>
                <button class="app-card" type="button" data-app-name="Tele2 Kazakhstan" data-app-browser="https://apps.apple.com/no/app/tele2-kazakhstan/id1541641406" data-app-link="https://apps.apple.com/no/app/tele2-kazakhstan/id1541641406">
                    <span class="app-icon">T2</span>
                    <span>Tele2</span>
                </button>
                <button class="app-card" type="button" data-app-name="Beeline Janymda" data-app-browser="https://janymda.kz/kz" data-app-link="https://janymda.kz/kz">
                    <span class="app-icon">BJ</span>
                    <span>Beeline (Janymda)</span>
                </button>
                <button class="app-card" type="button" data-app-name="Metro Almaty" data-app-browser="https://apps.apple.com/us/app/%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B5%D0%BD-%D0%B3%D0%BE%D1%80%D0%BE%D0%B4%D0%B0-%D0%B0%D0%BB%D0%BC%D0%B0%D1%82%D1%8B/id1420331940" data-app-link="https://apps.apple.com/us/app/%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B5%D0%BD-%D0%B3%D0%BE%D1%80%D0%BE%D0%B4%D0%B0-%D0%B0%D0%BB%D0%BC%D0%B0%D1%82%D1%8B/id1420331940">
                    <span class="app-icon">MA</span>
                    <span>Metro Almaty</span>
                </button>
                <button class="app-card" type="button" data-app-name="Instagram" data-app-browser="https://www.instagram.com/" data-app-link="instagram://">
                    <span class="app-icon">IG</span>
                    <span>Instagram</span>
                </button>
                <button class="app-card" type="button" data-app-name="UTO (testcenter.kz)" data-app-browser="https://apps.apple.com/kz/app/uto-kz/id6464261093" data-app-link="https://apps.apple.com/kz/app/uto-kz/id6464261093">
                    <span class="app-icon">UT</span>
                    <span>UTO (testcenter.kz)</span>
                </button>
                <button class="app-card" type="button" data-app-name="Eduser" data-app-browser="https://apps.apple.com/kz/app/eduser/id1667113593" data-app-link="https://apps.apple.com/kz/app/eduser/id1667113593">
                    <span class="app-icon">ED</span>
                    <span>Eduser</span>
                </button>
                <button class="app-card" type="button" data-app-name="JET" data-app-browser="https://start.jetshr.com" data-app-link="https://apps.apple.com/kz/app/jet-scooter-sharing/id1546127285">
                    <span class="app-icon">JT</span>
                    <span>JET</span>
                </button>
                <button class="app-card" type="button" data-app-name="Yandex Go" data-app-browser="https://go.yandex/" data-app-link="yandexgo://">
                    <span class="app-icon">YG</span>
                    <span>Yandex Go</span>
                </button>
                <button class="app-card" type="button" data-app-name="TV+" data-app-browser="https://tv.telecom.kz/en/my_tv" data-app-link="https://tv.telecom.kz/en/my_tv">
                    <span class="app-icon">TV</span>
                    <span>TV+</span>
                </button>
                <button class="app-card" type="button" data-app-name="Avtorynok.kz" data-app-browser="https://www.avtorynok.kz/" data-app-link="https://www.avtorynok.kz/">
                    <span class="app-icon">AV</span>
                    <span>Avtorynok.kz</span>
                </button>
                <button class="app-card" type="button" data-app-name="Kolesa.kz" data-app-browser="https://kolesa.kz/" data-app-link="https://kolesa.kz/">
                    <span class="app-icon">KO</span>
                    <span>Kolesa.kz</span>
                </button>
                <button class="app-card" type="button" data-app-name="Translator" data-app-browser="https://translate.google.com/" data-app-link="googletranslate://">
                    <span class="app-icon">TR</span>
                    <span>Translator</span>
                </button>
                <button class="app-card" type="button" data-app-name="Apple Music" data-app-browser="https://music.apple.com/" data-app-link="music://">
                    <span class="app-icon">AM</span>
                    <span>Apple Music</span>
                </button>
                <button class="app-card" type="button" data-app-name="Spotify" data-app-browser="https://open.spotify.com/" data-app-link="spotify://">
                    <span class="app-icon">SP</span>
                    <span>Spotify</span>
                </button>
                <button class="app-card" type="button" data-app-name="VK" data-app-browser="https://vk.com/" data-app-link="vk://">
                    <span class="app-icon">VK</span>
                    <span>VK</span>
                </button>
                <button class="app-card" type="button" data-app-name="Discord" data-app-browser="https://discord.com/" data-app-link="discord://">
                    <span class="app-icon">DC</span>
                    <span>Discord</span>
                </button>
                <button class="app-card" type="button" data-app-name="CapCut" data-app-browser="https://www.capcut.com/" data-app-link="capcut://">
                    <span class="app-icon">CC</span>
                    <span>CapCut</span>
                </button>
                <button class="app-card" type="button" data-app-name="Yandex Music" data-app-browser="https://music.yandex.kz/" data-app-link="yandexmusic://">
                    <span class="app-icon">YM</span>
                    <span>Yandex Music</span>
                </button>
                <button class="app-card" type="button" data-app-name="Starlink" data-app-browser="https://www.starlink.com/" data-app-link="https://www.starlink.com/">
                    <span class="app-icon">SL</span>
                    <span>Starlink</span>
                </button>
                <button class="app-card" type="button" data-app-name="Aitu" data-app-browser="https://apps.apple.com/kz/app/aitu-superapp/id1439789751" data-app-link="https://apps.apple.com/kz/app/aitu-superapp/id1439789751">
                    <span class="app-icon">AI</span>
                    <span>Aitu.kz</span>
                </button>
            </div>
        </div>
    </section>

    <div class="app-modal" id="appModal">
        <div class="app-modal-card">
            <div class="app-modal-title" id="appModalTitle">Open App</div>
            <div class="app-modal-sub" id="appModalSub" data-i18n="open_sub">Choose how you want to open</div>
            <div class="app-modal-actions">
                <a id="appBrowserLink" href="#" target="_blank" rel="noopener" data-i18n="open_browser">Open in Browser</a>
                <a id="appAppLink" href="#" class="secondary" data-i18n="open_app">Open App</a>
            </div>
            <button class="app-modal-close" id="appModalClose" data-i18n="close">Close</button>
        </div>
    </div>

    <div class="profile-modal" id="profileModal">
        <div class="modal-card">
            <div class="modal-title" data-i18n="profile_title">Edit Profile</div>
            <div class="modal-grid">
                <div class="modal-field">
                    <label for="profileName" data-i18n="profile_name">Name</label>
                    <input id="profileName" type="text" placeholder="Your name" data-i18n-placeholder="profile_name">
                </div>
                <div class="modal-field">
                    <label for="profileCity" data-i18n="profile_city">City</label>
                    <input id="profileCity" type="text" placeholder="Your city" data-i18n-placeholder="profile_city">
                </div>
                <div class="modal-field">
                    <label for="profileAge" data-i18n="profile_age">Age</label>
                    <input id="profileAge" type="number" min="1" max="120" placeholder="Your age" data-i18n-placeholder="profile_age">
                </div>
                <div class="modal-field">
                    <label for="profileAvatarFile" data-i18n="profile_avatar">Avatar file</label>
                    <input id="profileAvatarFile" type="file" accept="image/*">
                </div>
            </div>
            <div class="modal-row">
                <img id="profileAvatarPreview" class="avatar-preview" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Avatar preview">
                <div data-i18n="profile_preview">Preview</div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="profileCancel" data-i18n="profile_cancel">Cancel</button>
                <button class="btn-primary" id="profileSave" data-i18n="profile_save">Save</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const slides = document.querySelectorAll(".slide");
            const dots = document.querySelectorAll(".dot");
            let index = 0;
            let timer;

            function showSlide(i) {
                slides.forEach(slide => slide.classList.remove("active"));
                dots.forEach(dot => dot.classList.remove("active"));
                index = (i + slides.length) % slides.length;
                slides[index].classList.add("active");
                dots[index].classList.add("active");
            }

            function nextSlide() {
                showSlide(index + 1);
            }

            function prevSlide() {
                showSlide(index - 1);
            }

            window.nextSlide = nextSlide;
            window.prevSlide = prevSlide;

            function startAutoSlide() {
                timer = setInterval(nextSlide, 4000);
            }

            function stopAutoSlide() {
                clearInterval(timer);
            }

            startAutoSlide();

            document.querySelector(".hero").addEventListener("mouseenter", stopAutoSlide);
            document.querySelector(".hero").addEventListener("mouseleave", startAutoSlide);
        });

        function scrollDown() {
            document.getElementById('next').scrollIntoView({
                behavior: 'smooth'
            });
        }
    </script>

    <script>
const menuBtn = document.querySelector('.menu');
const sideMenu = document.getElementById('sideMenu');
const overlay = document.getElementById('sideOverlay');

menuBtn.addEventListener('click', () => {
    sideMenu.classList.add('active');
    overlay.classList.add('active');
});

overlay.addEventListener('click', () => {
    sideMenu.classList.remove('active');
    overlay.classList.remove('active');
});
</script>

<script>
  self.FIREBASE_APPCHECK_DEBUG_TOKEN = true;
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  import { initializeAppCheck, ReCaptchaEnterpriseProvider } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app-check.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCr6pAI4GCkwnlZEBq_1M1dWeWpGtrn1a4",
    authDomain: "frameacademy-bb04a.firebaseapp.com",
    projectId: "frameacademy-bb04a",
    storageBucket: "frameacademy-bb04a.firebasestorage.app",
    messagingSenderId: "1018686855581",
    appId: "1:1018686855581:web:e4f5d6f42ee6d43ba8b774",
    measurementId: "G-SDMK2NPGBZ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  initializeAppCheck(app, {
    provider: new ReCaptchaEnterpriseProvider("6Leh0WYsAAAAAHISvriKLV94fJuWFuJRgIaXbGUb"),
    isTokenAutoRefreshEnabled: true
  });

  const loginBtn = document.getElementById('loginBtn');
  const registerBtn = document.getElementById('registerBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const userNameH3 = document.querySelector('.side-header h3');
  const userMetaP = document.querySelector('.side-header p');
  const sideEmail = document.getElementById('sideEmail');
  const sideAvatar = document.querySelector('.side-header img');
  const headerName = document.getElementById('headerName');
  const headerAvatar = document.getElementById('headerAvatar');
  const editProfileBtn = document.getElementById('editProfileBtn');
  const profileModal = document.getElementById('profileModal');
  const profileName = document.getElementById('profileName');
  const profileCity = document.getElementById('profileCity');
  const profileAge = document.getElementById('profileAge');
  const profileAvatarFile = document.getElementById('profileAvatarFile');
  const profileAvatarPreview = document.getElementById('profileAvatarPreview');
  const profileSave = document.getElementById('profileSave');
  const profileCancel = document.getElementById('profileCancel');
  let pendingAvatarData = "";
  let toastTimer;

  function showToast(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'toast';
      document.body.appendChild(toast);
    }
    toast.innerHTML = '';
    const title = document.createElement('div');
    title.className = 'toast-title';
    title.textContent = 'Push notification';
    const msg = document.createElement('div');
    msg.className = 'toast-msg';
    msg.textContent = message;
    toast.appendChild(title);
    toast.appendChild(msg);
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
      toast.classList.remove('show');
    }, 2400);
  }

  function getProfile() {
    const raw = localStorage.getItem('profile');
    if (!raw) return { name: "", city: "", age: "", avatarData: "" };
    try { return JSON.parse(raw); } catch { return { name: "", city: "", age: "", avatarData: "" }; }
  }

  function setProfile(profile) {
    localStorage.setItem('profile', JSON.stringify(profile));
  }

  async function fetchProfile(user) {
    if (!user) return getProfile();
    try {
      const snap = await getDoc(doc(db, "users", user.uid));
      if (snap.exists()) {
        const data = snap.data();
        const profile = {
          name: data.name || "",
          city: data.city || "",
          age: data.age || "",
          avatarData: data.avatarData || ""
        };
        setProfile(profile);
        return profile;
      }
    } catch (err) {
      console.warn("Profile load failed:", err);
    }
    return getProfile();
  }

  async function applyProfile(user) {
    const profile = await fetchProfile(user);
    const displayName = profile.name || (user && (user.displayName || user.email || user.phoneNumber)) || "USER";
    const city = profile.city || "City";
    const age = profile.age || "Age";
    const avatar = profile.avatarData || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
    const email = (user && user.email) ? user.email : "";

    if (userNameH3) userNameH3.textContent = displayName;
    if (userMetaP) userMetaP.textContent = `${city} • ${age}`;
    if (sideEmail) sideEmail.textContent = email || "";
    if (sideAvatar) sideAvatar.src = avatar;
    if (headerName) headerName.textContent = displayName;
    if (headerAvatar) headerAvatar.src = avatar;
    if (profileAvatarPreview) profileAvatarPreview.src = avatar;
  }

  window.showLoginForm = async () => {
    const email = prompt("Enter email:");
    const password = prompt("Enter password:");
    if (!email || !password) return;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      showToast(`Signed in: ${userCredential.user.email}`);
      document.getElementById('sideMenu').classList.remove('active');
      document.getElementById('sideOverlay').classList.remove('active');
    } catch (error) {
      showToast(error.message);
    }
  }

  window.showRegisterForm = async () => {
    const email = prompt("Enter email:");
    const password = prompt("Enter password (min 6 chars):");
    if (!email || !password) return;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      showToast(`Registered: ${userCredential.user.email}`);
      document.getElementById('sideMenu').classList.remove('active');
      document.getElementById('sideOverlay').classList.remove('active');
    } catch (error) {
      showToast(error.message);
    }
  }

  window.logout = async () => {
    try {
      await signOut(auth);
      localStorage.removeItem('profile');
      await applyProfile(null);
      showToast("Signed out");
      document.getElementById('sideMenu').classList.remove('active');
      document.getElementById('sideOverlay').classList.remove('active');
    } catch(err){
      showToast(err.message);
    }
  }

  onAuthStateChanged(auth, async (user) => {
    if(user){
      await applyProfile(user);
      loginBtn.style.display = 'none';
      registerBtn.style.display = 'none';
      logoutBtn.style.display = 'block';
    } else {
      await applyProfile(null);
      loginBtn.style.display = 'inline-block';
      registerBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
    }
  });

  if (editProfileBtn && profileModal) {
    editProfileBtn.addEventListener('click', () => {
      const current = getProfile();
      profileName.value = current.name || "";
      profileCity.value = current.city || "";
      profileAge.value = current.age || "";
      pendingAvatarData = current.avatarData || "";
      profileAvatarPreview.src = pendingAvatarData || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
      profileAvatarFile.value = "";
      profileModal.classList.add('active');
    });
  }

  if (profileCancel && profileModal) {
    profileCancel.addEventListener('click', () => {
      profileModal.classList.remove('active');
    });
  }

  if (profileAvatarFile) {
    profileAvatarFile.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        pendingAvatarData = String(reader.result || "");
        profileAvatarPreview.src = pendingAvatarData;
      };
      reader.readAsDataURL(file);
    });
  }

  if (profileSave && profileModal) {
    profileSave.addEventListener('click', async () => {
      const updated = {
        name: profileName.value.trim(),
        city: profileCity.value.trim(),
        age: profileAge.value.trim(),
        avatarData: pendingAvatarData
      };
      setProfile(updated);
      if (auth.currentUser) {
        try {
          await setDoc(doc(db, "users", auth.currentUser.uid), updated, { merge: true });
          showToast("Profile saved");
        } catch (err) {
          console.warn("Profile save failed:", err);
          showToast("Profile save failed");
        }
      }
      await applyProfile(auth.currentUser || null);
      profileModal.classList.remove('active');
    });
  }
</script>

<script>
  const downloadBtn = document.getElementById('downloadBtn');
  const downloadFile = document.getElementById('downloadFile');
  const downloadNote = document.getElementById('downloadNote');

  if (downloadBtn && downloadFile) {
    downloadBtn.addEventListener('click', (e) => {
      e.preventDefault();
      downloadFile.click();
    });

    downloadFile.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      downloadBtn.href = url;
      downloadBtn.setAttribute('download', file.name);
      if (window.i18n) {
        downloadNote.textContent = window.i18n.t("download_ready");
      } else {
        downloadNote.textContent = "Ready to download";
      }
    });
  }
</script>

<script>
  const appModal = document.getElementById('appModal');
  const appModalTitle = document.getElementById('appModalTitle');
  const appModalSub = document.getElementById('appModalSub');
  const appBrowserLink = document.getElementById('appBrowserLink');
  const appAppLink = document.getElementById('appAppLink');
  const appModalClose = document.getElementById('appModalClose');

  function openAppModal(btn) {
    const name = btn.getAttribute('data-app-name') || 'App';
    const browser = btn.getAttribute('data-app-browser') || '#';
    const appLink = btn.getAttribute('data-app-link') || '#';
    appModalTitle.textContent = name;
    appBrowserLink.href = browser;
    appAppLink.href = appLink;
    appModal.classList.add('active');
  }

  document.querySelectorAll('.app-card').forEach((btn) => {
    btn.addEventListener('click', () => openAppModal(btn));
  });

  if (appModalClose) {
    appModalClose.addEventListener('click', () => appModal.classList.remove('active'));
  }

  if (appModal) {
    appModal.addEventListener('click', (e) => {
      if (e.target === appModal) appModal.classList.remove('active');
    });
  }
</script>

<script src="lang.js"></script>

</body>
</html>
