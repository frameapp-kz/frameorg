<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <title>Gallery - Site Name</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <style>
        body{
            margin:0;
            font-family:'Poppins', sans-serif;
            background: linear-gradient(160deg, #313137 0%, #16161c 45%, #101018 100%);
            min-height:100vh;
        }

        .page-title{
            text-align:center;
            margin-top:120px;
            font-size:50px;
            font-weight:800;
            color:white;
            text-shadow:0 8px 20px rgba(0,0,0,0.6);
        }

        .gallery-container{
            width:90%;
            max-width:1200px;
            margin:50px auto 80px auto;
            background:white;
            border-radius:40px;
            padding:40px;
            box-shadow:0 25px 60px rgba(0,0,0,0.5);
        }

        .gallery-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
            gap:25px;
        }

        .gallery-item{
            overflow:hidden;
            border-radius:25px;
            position:relative;
            cursor:pointer;
        }

        .gallery-item img{
            width:100%;
            height:250px;
            object-fit:cover;
            transition:0.5s;
        }

        .gallery-item:hover img{
            transform:scale(1.1);
        }

        .gallery-item::after{
            content:"VIEW";
            position:absolute;
            bottom:0;
            left:0;
            right:0;
            background:rgba(0,0,0,0.6);
            color:white;
            text-align:center;
            padding:10px;
            opacity:0;
            transition:0.3s;
            font-weight:600;
        }

        .gallery-item:hover::after{
            opacity:1;
        }

    </style>
</head>

<body>

<!-- üîù HEADER -->
<header>
    <div class="logo">
        <img src="https://img.freepik.com/free-vector/bird-colorful-gradient-design-vector_343694-2506.jpg" width="40" alt="FrameAcademy logo">
        <span>FrameAcademy App</span>
    </div>
    <nav>
        <a href="index.html" data-i18n="nav_home">HOME</a>
        <a href="aboutus.html" data-i18n="nav_about">ABOUT</a>
        <a href="gallery.html" class="active" data-i18n="nav_gallery">GALLERY</a>
        <a href="social.html" data-i18n="nav_social">SOCIAL MEDIA</a>
        <a href="contact.html" data-i18n="nav_contact">CONTACT</a>
    </nav>
    <div class="lang-switch">
        <select aria-label="Language" data-lang-select>
            <option value="en">English</option>
            <option value="kk">“ö–∞–∑–∞“õ –¢—ñ–ª—ñ</option>
            <option value="zh">‰∏≠Êñá</option>
        </select>
    </div>
    <div class="user-chip">
        <img id="headerAvatar" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User avatar">
        <span id="headerName">USER</span>
    </div>
    <div class="menu">‚ò∞</div>
</header>

<!-- SIDE MENU -->
<div class="side-menu" id="sideMenu">
    <div class="side-header">
        <div class="user-avatar">
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User avatar">
        </div>
        <h3>USER_NAME</h3>
        <div class="side-email" id="sideEmail">user@email.com</div>
        <p data-i18n="profile_meta">City ‚Ä¢ Age</p>
    </div>

    <div class="side-links">
        <button id="editProfileBtn" class="profile-btn" data-i18n="edit_profile">Edit Profile</button>
        <div class="side-lang">
            <select aria-label="Language" data-lang-select>
                <option value="en">English</option>
                <option value="kk">“ö–∞–∑–∞“õ –¢—ñ–ª—ñ</option>
                <option value="zh">‰∏≠Êñá</option>
            </select>
        </div>
        <a href="index.html" data-i18n="nav_home">HOME</a>
        <a href="aboutus.html" data-i18n="nav_about">ABOUT</a>
        <a href="gallery.html" data-i18n="nav_gallery">GALLERY</a>
        <a href="social.html" data-i18n="nav_social">SOCIAL MEDIA</a>
        <a href="contact.html" data-i18n="nav_contact">CONTACT</a>
    </div>

    <div class="auth-buttons">
        <a id="loginBtn" href="kiru.html" class="auth-btn" data-i18n="auth_login">Log in</a>
        <a id="registerBtn" href="tirkelu.html" class="auth-btn" data-i18n="auth_register">Register</a>
        <button id="logoutBtn" class="auth-btn" onclick="logout()" style="display:none;" data-i18n="auth_logout">Log Out</button>
    </div>
</div>

<div class="side-overlay" id="sideOverlay"></div>

<h1 class="page-title" data-i18n="gallery_title">GALLERY</h1>

<div class="gallery-container">
    <div class="gallery-grid">
        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470" alt="Mountain landscape">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e" alt="Forest trail">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee" alt="Sunset over hills">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1470770841072-f978cf4d019e" alt="Lake and forest">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1493244040629-496f6d136cc3" alt="Mountain ridge">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e" alt="Ocean waves">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e" alt="Green valley">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1500534314209-a25ddb2bd429" alt="Forest road">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1472214103451-9374bd1c798e" alt="Snowy peak">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1482192596544-9eb780fc7f66" alt="Mountain lake">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1470770903676-69b98201ea1c" alt="River in forest">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb" alt="Lake reflections">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05" alt="Misty mountains">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1465146344425-f00d5f5c8f07" alt="Forest canopy">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1475924156734-496f6cac6ec1" alt="Desert dunes">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1454044778841-7f5b6837fbaa" alt="Northern lights">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1500534623283-312aade485b7" alt="Rocky coastline">
        </div>

        <div class="gallery-item">
            <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa" alt="City skyline at dusk">
        </div>
    </div>
</div>

<div class="profile-modal" id="profileModal">
    <div class="modal-card">
        <div class="modal-title" data-i18n="profile_title">Edit Profile</div>
        <div class="modal-grid">
            <div class="modal-field">
                <label for="profileName" data-i18n="profile_name">Name</label>
                <input id="profileName" type="text" placeholder="Your name" data-i18n-placeholder="profile_name">
            </div>
            <div class="modal-field">
                <label for="profileCity" data-i18n="profile_city">City</label>
                <input id="profileCity" type="text" placeholder="Your city" data-i18n-placeholder="profile_city">
            </div>
            <div class="modal-field">
                <label for="profileAge" data-i18n="profile_age">Age</label>
                <input id="profileAge" type="number" min="1" max="120" placeholder="Your age" data-i18n-placeholder="profile_age">
            </div>
            <div class="modal-field">
                <label for="profileAvatarFile" data-i18n="profile_avatar">Avatar file</label>
                <input id="profileAvatarFile" type="file" accept="image/*">
            </div>
        </div>
        <div class="modal-row">
            <img id="profileAvatarPreview" class="avatar-preview" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Avatar preview">
            <div data-i18n="profile_preview">Preview</div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" id="profileCancel" data-i18n="profile_cancel">Cancel</button>
            <button class="btn-primary" id="profileSave" data-i18n="profile_save">Save</button>
        </div>
    </div>
</div>

<script>
    const menuBtn = document.querySelector('.menu');
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideOverlay');

    menuBtn.addEventListener('click', () => {
        sideMenu.classList.add('active');
        overlay.classList.add('active');
    });

    overlay.addEventListener('click', () => {
        sideMenu.classList.remove('active');
        overlay.classList.remove('active');
    });
</script>

<script>
  self.FIREBASE_APPCHECK_DEBUG_TOKEN = true;
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  import { initializeAppCheck, ReCaptchaEnterpriseProvider } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app-check.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCr6pAI4GCkwnlZEBq_1M1dWeWpGtrn1a4",
    authDomain: "frameacademy-bb04a.firebaseapp.com",
    projectId: "frameacademy-bb04a",
    storageBucket: "frameacademy-bb04a.firebasestorage.app",
    messagingSenderId: "1018686855581",
    appId: "1:1018686855581:web:e4f5d6f42ee6d43ba8b774",
    measurementId: "G-SDMK2NPGBZ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  initializeAppCheck(app, {
    provider: new ReCaptchaEnterpriseProvider("6Leh0WYsAAAAAHISvriKLV94fJuWFuJRgIaXbGUb"),
    isTokenAutoRefreshEnabled: true
  });

  const loginBtn = document.getElementById('loginBtn');
  const registerBtn = document.getElementById('registerBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const userNameH3 = document.querySelector('.side-header h3');
  const userMetaP = document.querySelector('.side-header p');
  const sideEmail = document.getElementById('sideEmail');
  const sideAvatar = document.querySelector('.side-header img');
  const headerName = document.getElementById('headerName');
  const headerAvatar = document.getElementById('headerAvatar');
  const editProfileBtn = document.getElementById('editProfileBtn');
  const profileModal = document.getElementById('profileModal');
  const profileName = document.getElementById('profileName');
  const profileCity = document.getElementById('profileCity');
  const profileAge = document.getElementById('profileAge');
  const profileAvatarFile = document.getElementById('profileAvatarFile');
  const profileAvatarPreview = document.getElementById('profileAvatarPreview');
  const profileSave = document.getElementById('profileSave');
  const profileCancel = document.getElementById('profileCancel');
  let pendingAvatarData = "";
  let toastTimer;

  function showToast(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'toast';
      document.body.appendChild(toast);
    }
    toast.innerHTML = '';
    const title = document.createElement('div');
    title.className = 'toast-title';
    title.textContent = 'Push notification';
    const msg = document.createElement('div');
    msg.className = 'toast-msg';
    msg.textContent = message;
    toast.appendChild(title);
    toast.appendChild(msg);
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
      toast.classList.remove('show');
    }, 2400);
  }

  function getProfile() {
    const raw = localStorage.getItem('profile');
    if (!raw) return { name: "", city: "", age: "", avatarData: "" };
    try { return JSON.parse(raw); } catch { return { name: "", city: "", age: "", avatarData: "" }; }
  }

  function setProfile(profile) {
    localStorage.setItem('profile', JSON.stringify(profile));
  }

  async function fetchProfile(user) {
    if (!user) return getProfile();
    try {
      const snap = await getDoc(doc(db, "users", user.uid));
      if (snap.exists()) {
        const data = snap.data();
        const profile = {
          name: data.name || "",
          city: data.city || "",
          age: data.age || "",
          avatarData: data.avatarData || ""
        };
        setProfile(profile);
        return profile;
      }
    } catch (err) {
      console.warn("Profile load failed:", err);
    }
    return getProfile();
  }

  async function applyProfile(user) {
    const profile = await fetchProfile(user);
    const displayName = profile.name || (user && (user.displayName || user.email || user.phoneNumber)) || "USER";
    const city = profile.city || "City";
    const age = profile.age || "Age";
    const avatar = profile.avatarData || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
    const email = (user && user.email) ? user.email : "";

    if (userNameH3) userNameH3.textContent = displayName;
    if (userMetaP) userMetaP.textContent = `${city} ‚Ä¢ ${age}`;
    if (sideEmail) sideEmail.textContent = email || "";
    if (sideAvatar) sideAvatar.src = avatar;
    if (headerName) headerName.textContent = displayName;
    if (headerAvatar) headerAvatar.src = avatar;
    if (profileAvatarPreview) profileAvatarPreview.src = avatar;
  }

  window.logout = async () => {
    try {
      await signOut(auth);
      localStorage.removeItem('profile');
      await applyProfile(null);
      showToast("Signed out");
      document.getElementById('sideMenu').classList.remove('active');
      document.getElementById('sideOverlay').classList.remove('active');
    } catch (err) {
      showToast(err.message);
    }
  };

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      await applyProfile(user);
      loginBtn.style.display = 'none';
      registerBtn.style.display = 'none';
      logoutBtn.style.display = 'block';
    } else {
      await applyProfile(null);
      loginBtn.style.display = 'inline-block';
      registerBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
    }
  });

  if (editProfileBtn && profileModal) {
    editProfileBtn.addEventListener('click', () => {
      const current = getProfile();
      profileName.value = current.name || "";
      profileCity.value = current.city || "";
      profileAge.value = current.age || "";
      pendingAvatarData = current.avatarData || "";
      profileAvatarPreview.src = pendingAvatarData || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
      profileAvatarFile.value = "";
      profileModal.classList.add('active');
    });
  }

  if (profileCancel && profileModal) {
    profileCancel.addEventListener('click', () => {
      profileModal.classList.remove('active');
    });
  }

  if (profileAvatarFile) {
    profileAvatarFile.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        pendingAvatarData = String(reader.result || "");
        profileAvatarPreview.src = pendingAvatarData;
      };
      reader.readAsDataURL(file);
    });
  }

  if (profileSave && profileModal) {
    profileSave.addEventListener('click', async () => {
      const updated = {
        name: profileName.value.trim(),
        city: profileCity.value.trim(),
        age: profileAge.value.trim(),
        avatarData: pendingAvatarData
      };
      setProfile(updated);
      if (auth.currentUser) {
        try {
          await setDoc(doc(db, "users", auth.currentUser.uid), updated, { merge: true });
          showToast("Profile saved");
        } catch (err) {
          console.warn("Profile save failed:", err);
          showToast("Profile save failed");
        }
      }
      await applyProfile(auth.currentUser || null);
      profileModal.classList.remove('active');
    });
  }
</script>

<script src="scripts/lang.js"></script>

</body>
</html>
